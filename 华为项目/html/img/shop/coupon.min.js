ec.pkg("ec.product.coupon");ec.product.coupon={sbomCouponList:{},applyResultList:{},loadCoupon:function(a){$("#couponBtn").html("");ec.product.coupon.loadCouponEx(a,function(b){if(b&&b.success&&b.couponList&&b.couponList.length>0){ec.product.coupon.sbomCouponList[a]=b.couponList;$("#couponBtn").html('<a href="javascript:;" onclick="ec.product.coupon.clickBtn(\''+a+'\')" class="product-price-btn" > </a>')}else{}},function(b){},function(){})},loadCouponEx:function(d,a,c,b){new ec.ajax().get({url:"/product/queryCoupon.json?sbom="+d+"&t="+new Date().getTime(),type:"get",dateType:"json",timeout:10000,timeoutFunction:function(){b()},successFunction:function(e){a(e)},errorFunction:function(e){c(e)}})},clickBtn:function(a){ec.product.coupon.showDialog(a)},closeDialog:function(){$("#pro-roll-page").hide()},showDialog:function(a){$("#pro-roll-message").html("");$("#pro-roll-list").html("");$("#pro-roll-page").hide();var b=ec.product.coupon.sbomCouponList[a];if(b){ec.product.coupon.showDialogEx(a,b)}else{ec.product.coupon.loadCouponEx(a,function(c){if(c&&c.success&&c.couponList&&c.couponList.length>0){ec.product.coupon.sbomCouponList[a]=c.couponList;ec.product.coupon.showDialogEx(a,c.couponList)}else{}},function(){},function(){})}},showDialogEx:function(a,d){var c=[];for(var b=0;b<d.length;b++){paramsReceiveCoupon="'"+d[b].activityCode+"','"+d[b].batchCode+"'";c.push('<li class="product-roll-detail" title="'+d[b].batchName+'">');c.push(' <a href="javascript:;"  onclick="ec.product.coupon.receiveCoupon('+paramsReceiveCoupon+')"> <em>\u00a5</em>');c.push(' <div class="product-roll-info">');c.push('  <div class="product-roll-price clearfix">');c.push("    <span>"+d[b].amount+"</span>");c.push("    <strong>\u4f18\u60e0\u5238</strong>");c.push("  </div>");c.push(' <p class="product-roll-word">'+d[b].batchName+"</p>");c.push(' <p class="product-roll-time">'+new Date(d[b].beginDate).format("yyyy-MM-dd")+" \u81f3 "+new Date(d[b].endDate).format("yyyy-MM-dd")+"</p>");c.push("</div>");c.push('<div class="product-roll-btn">\u7acb<br>\u5373<br>\u9886<br>\u53d6</div>');c.push("</a></li>")}var c='<ul class="clearfix">'+c.join(" ")+"</ul>";$("#pro-roll-list").html(c);$("#pro-roll-page").show()},goLogin:function(){var a=domainMain+"/account/login?url="+encodeURIComponent(window.location.pathname+"#"+ec.product.getSku())+"&_t="+new Date().getTime();window.location.href=a},showMsg:function(b){b=""+b;var a="";switch(b){case"9200":a="\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~";break;case"9201":a="\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~";break;case"9202":a="\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~";break;case"9203":a="\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~";break;case"9204":a="\u4eb2\uff0c\u522b\u7740\u6025\uff0c\u6d3b\u52a8\u8fd8\u6ca1\u5f00\u59cb\u5466~~";break;case"9205":a="\u5662\uff0c\u4eb2\uff0c\u6765\u665a\u4e86\uff0c\u6d3b\u52a8\u7ed3\u675f\u4e86~";break;case"9206":a="\u4eb2\uff0c\u60a8\u8fd8\u672a\u767b\u5f55\uff0c\u767b\u5f55\u540e\u624d\u80fd\u9886\u53d6\u54e6~";a+='<a href="javascript:;" onclick="ec.product.coupon.goLogin()" >\u9a6c\u4e0a\u767b\u5f55</a>';break;case"9207":a="\u4eb2\uff0c\u60a8\u6682\u65f6\u4e0d\u7b26\u5408\u6d3b\u52a8\u53c2\u4e0e\u6761\u4ef6\u54e6~";break;case"9208":a="\u4eb2\uff0c\u9700\u7ed1\u5b9a\u624b\u673a\u5e10\u53f7\u624d\u80fd\u9886\u53d6\u54e6\uff0c\u9a6c\u4e0a\u7ed1\u5b9a\u5427~";a+='<a href="'+$("#accountCenterUrl").val()+'" target="_blank" >\u53bb\u7ed1\u5b9a</a>';break;case"9209":a="\u4eb2\uff0c\u9700\u5b9e\u540d\u8ba4\u8bc1\u624d\u80fd\u9886\u53d6\u54e6\uff0c\u624b\u673a\u5e10\u53f7\u767b\u5f55\u5b9e\u540d\u8ba4\u8bc1\u66f4\u4fbf\u6377\u54e6\uff01";a+='<a href="'+$("#authUrl").val()+'" target="_blank" >\u53bb\u8ba4\u8bc1</a>';break;case"9210":a="\u4eb2\uff0c\u9700\u5b8c\u5584\u8d44\u6599\u624d\u80fd\u9886\u53d6\u54e6~";a+='<a href="'+$("#notFinishAllUPDataURL").val()+'" target="_blank" >\u5b8c\u5584\u8d44\u6599</a>';break;case"9211":a="\u4eb2\uff0c\u6b64\u6d3b\u52a8\u4ec5\u9650\u65b0\u7528\u6237\u53c2\u4e0e\u54e6~";break;case"9212":a="\u4eb2\uff0c\u60a8\u5df2\u9886\u8fc7\u5566\uff0c\u8bf7\u770b\u770b\u5176\u5b83\u4f18\u60e0\u5238\u5427~";break;case"9213":a="\u4eb2\uff0c\u60a8\u6682\u65f6\u4e0d\u7b26\u5408\u6d3b\u52a8\u53c2\u4e0e\u6761\u4ef6\u54e6~";break;case"9214":a="\u5662\uff0c\u4eb2\uff0c\u6765\u665a\u4e86\uff0c\u4eca\u5929\u7684\u4f18\u60e0\u5238\u5df2\u7ecf\u9886\u5b8c\u4e86\uff0c\u770b\u770b\u5176\u5b83\u6d3b\u52a8\u5427~";break;case"9215":a="\u4eb2\uff0c\u60a8\u6682\u65f6\u4e0d\u7b26\u5408\u6d3b\u52a8\u53c2\u4e0e\u6761\u4ef6\u54e6~";break;default:a="\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~"}a="<span>"+a+"</span>";$("#pro-roll-message").html(a);$("#pro-roll-message").addClass("product-layer-tips")},receiveCoupon:function(a,c){var b=ec.product.coupon.applyResultList[a+"|"+c];if(b&&b=="9212"){ec.product.coupon.showMsg(b);return}ec.product.syncCustomSession();$("#pro-roll-message").html("");$("#pro-roll-message").removeClass();$.ajax({url:domainAms+"/couponCodeActivity/receive.json?activityCode="+a+"&batchCode="+c+"&t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(d){if(d&&d.success){$("#pro-roll-message").html("<span>\u4f18\u60e0\u5238\u9886\u53d6\u6210\u529f</span>");$("#pro-roll-message").addClass("product-layer-tips product-layer-success");return}if(!d.code){$("#pro-roll-message").addClass("product-layer-tips");$("#pro-roll-message").html("<span>\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~</span>");return}ec.product.coupon.applyResultList[a+"|"+c]=""+d.code;ec.product.coupon.showMsg(d.code)},error:function(){$("#pro-roll-message").addClass("product-layer-tips");$("#pro-roll-message").html("<span>\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~</span>")}})}};
